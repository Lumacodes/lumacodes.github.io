import React, { useEffect, useRef, useState } from "react";
import { motion } from "framer-motion";
import Two from "two.js";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";
import { Moon, Sun, Github, Link as LinkIcon, Mail, Download } from "lucide-react";

// --- Minimal Apple-like Design Philosophy ---
// 1) Focus on whitespace, hierarchy, and restraint.
// 2) Smooth micro‑interactions, no clutter.
// 3) Typography first; color comes from content.
// 4) Subtle, delightful background motion (Two.js) that never distracts.

// ----- Subtle Animated Background (Two.js) -----
function SoftBackground() {
  const ref = useRef(null);
  const twoRef = useRef(null);

  useEffect(() => {
    const el = ref.current;
    if (!el) return;

    const two = new Two({ type: Two.Types.canvas, fitted: true, autostart: true }).appendTo(el);
    twoRef.current = two;

    // Create a softly pulsing network of dots connected by lines.
    const dots = [];
    const lines = [];
    const cols = 16;
    const rows = 10;

    const padding = 60;
    const gw = () => Math.max(800, el.clientWidth);
    const gh = () => Math.max(600, el.clientHeight);

    const makeGrid = () => {
      dots.splice(0, dots.length);
      lines.splice(0, lines.length);
      two.clear();

      const w = gw();
      const h = gh();
      const dx = (w - padding * 2) / (cols - 1);
      const dy = (h - padding * 2) / (rows - 1);

      for (let j = 0; j < rows; j++) {
        for (let i = 0; i < cols; i++) {
          const x = padding + i * dx + (Math.random() - 0.5) * 8;
          const y = padding + j * dy + (Math.random() - 0.5) * 8;
          const c = two.makeCircle(x, y, 1.8);
          c.noStroke();
          c.fill = "rgba(100,100,120,0.35)";
          c.original = { x, y };
          dots.push(c);
        }
      }

      // Connect to right and bottom neighbors for a soft lattice
      const index = (i, j) => j * cols + i;
      for (let j = 0; j < rows; j++) {
        for (let i = 0; i < cols; i++) {
          if (i < cols - 1) {
            const l = two.makeLine(dots[index(i, j)].translation.x, dots[index(i, j)].translation.y, dots[index(i + 1, j)].translation.x, dots[index(i + 1, j)].translation.y);
            l.linewidth = 0.7;
            l.stroke = "rgba(120,120,140,0.25)";
            lines.push(l);
          }
          if (j < rows - 1) {
            const l = two.makeLine(dots[index(i, j)].translation.x, dots[index(i, j)].translation.y, dots[index(i, j + 1)].translation.x, dots[index(i, j + 1)].translation.y);
            l.linewidth = 0.7;
            l.stroke = "rgba(120,120,140,0.18)";
            lines.push(l);
          }
        }
      }
    };

    makeGrid();

    let t = 0;
    two.bind("update", () => {
      t += 0.005;
      const w = gw();
      const h = gh();
      // gentle parallax drift
      dots.forEach((c, idx) => {
        const ox = c.original.x;
        const oy = c.original.y;
        const k = 0.8 + (idx % 17) * 0.005;
        c.translation.x = ox + Math.sin(t * k + idx) * 3;
        c.translation.y = oy + Math.cos(t * k + idx) * 3;
      });

      // keep canvas sized
      if (two.width !== w || two.height !== h) {
        two.width = w; two.height = h; makeGrid();
      }
    });

    const onResize = () => {
      two.width = gw();
      two.height = gh();
      makeGrid();
    };

    window.addEventListener("resize", onResize);
    return () => {
      window.removeEventListener("resize", onResize);
      two.pause();
      two.unbind("update");
      two.clear();
      if (el) {
        while (el.firstChild) el.removeChild(el.firstChild);
      }
    };
  }, []);

  return (
    <div ref={ref} aria-hidden className="pointer-events-none absolute inset-0 -z-10 opacity-80 [mask-image:radial-gradient(60%_60%_at_50%_40%,#000,transparent)]" />
  );
}

// ----- Navigation -----
function Nav({ theme, toggleTheme }) {
  const items = [
    { href: "#home", label: "Home" },
    { href: "#work", label: "Work" },
    { href: "#about", label: "About" },
    { href: "#contact", label: "Contact" },
  ];
  return (
    <div className="sticky top-0 z-20 backdrop-blur supports-[backdrop-filter]:bg-white/60 dark:supports-[backdrop-filter]:bg-neutral-900/60 border-b border-neutral-200 dark:border-neutral-800">
      <nav className="mx-auto flex max-w-6xl items-center justify-between px-4 py-3">
        <a href="#home" className="text-xl font-semibold tracking-tight dark:text-white">luma</a>
        <div className="flex items-center gap-6">
          {items.map((i) => (
            <a key={i.href} href={i.href} className="text-sm text-neutral-700 hover:text-black dark:text-neutral-300 dark:hover:text-white transition-colors">
              {i.label}
            </a>
          ))}
          <Button variant="ghost" size="icon" aria-label="Toggle theme" onClick={toggleTheme} className="rounded-2xl">
            {theme === "light" ? <Moon className="h-5 w-5" /> : <Sun className="h-5 w-5" />}
          </Button>
        </div>
      </nav>
    </div>
  );
}

// ----- Reusable Section Wrapper -----
function Section({ id, title, kicker, children }) {
  return (
    <section id={id} className="relative mx-auto max-w-6xl px-4 py-20">
      <div className="mb-8">
        {kicker && <p className="text-xs uppercase tracking-[0.2em] text-neutral-500 dark:text-neutral-400">{kicker}</p>}
        <h2 className="mt-2 text-3xl font-semibold tracking-tight text-black dark:text-white">{title}</h2>
      </div>
      {children}
    </section>
  );
}

function Hero() {
  return (
    <header id="home" className="relative mx-auto flex max-w-6xl flex-col items-center gap-8 px-4 pb-24 pt-28 text-center">
      <SoftBackground />
      <motion.h1 initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.6 }} className="text-5xl font-semibold tracking-tight text-black dark:text-white">
        Subhajit Sarkar
      </motion.h1>
      <motion.p initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.7, delay: 0.1 }} className="max-w-2xl text-balance text-lg leading-relaxed text-neutral-700 dark:text-neutral-300">
        Building calm, precise, human interfaces. Frontend engineer & creative coder exploring React, Tailwind, and generative visuals.
      </motion.p>
      <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ duration: 0.8, delay: 0.2 }} className="flex flex-wrap items-center justify-center gap-3">
        <Button asChild size="sm" className="rounded-2xl">
          <a href="#work">View Work</a>
        </Button>
        <Button variant="secondary" size="sm" asChild className="rounded-2xl">
          <a href="#contact"><Mail className="mr-2 h-4 w-4"/>Contact</a>
        </Button>
        <Button variant="ghost" size="sm" asChild className="rounded-2xl">
          <a href="/resume.pdf" download><Download className="mr-2 h-4 w-4"/>Résumé</a>
        </Button>
      </motion.div>
      <div className="mt-8 grid w-full grid-cols-2 gap-3 sm:grid-cols-4">
        {["React", "Tailwind", "Two.js", "Framer Motion"].map((t) => (
          <div key={t} className="rounded-2xl border border-neutral-200/70 px-3 py-2 text-center text-xs text-neutral-600 shadow-sm dark:border-neutral-800 dark:text-neutral-300">
            {t}
          </div>
        ))}
      </div>
    </header>
  );
}

function ProjectCard({ title, description, tags = [], href, repo }) {
  return (
    <Card className="rounded-3xl border-neutral-200 shadow-sm dark:border-neutral-800">
      <CardHeader>
        <CardTitle className="flex items-center justify-between">
          <span>{title}</span>
          <div className="flex items-center gap-2">
            {href && (
              <a href={href} aria-label="Live" className="text-neutral-500 hover:text-black dark:text-neutral-400 dark:hover:text-white">
                <LinkIcon className="h-4 w-4" />
              </a>
            )}
            {repo && (
              <a href={repo} aria-label="GitHub" className="text-neutral-500 hover:text-black dark:text-neutral-400 dark:hover:text-white">
                <Github className="h-4 w-4" />
              </a>
            )}
          </div>
        </CardTitle>
      </CardHeader>
      <CardContent>
        <p className="text-sm text-neutral-700 dark:text-neutral-300">{description}</p>
        <div className="mt-4 flex flex-wrap gap-2">
          {tags.map((t) => (
            <span key={t} className="rounded-full border border-neutral-200 px-2 py-1 text-[10px] uppercase tracking-wider text-neutral-600 dark:border-neutral-800 dark:text-neutral-300">
              {t}
            </span>
          ))}
        </div>
      </CardContent>
    </Card>
  );
}

function Work() {
  const projects = [
    {
      title: "Hand‑drawn Portfolio",
      description: "Interactive sketch aesthetic with physics‑based doodles and smooth page transitions.",
      tags: ["React", "Tailwind", "Framer"],
      href: "#",
      repo: "#",
    },
    {
      title: "Generative Grid",
      description: "Two.js lattice animation rendered on the GPU‑friendly canvas for ultra‑low CPU impact.",
      tags: ["Two.js", "Canvas", "Perf"],
      href: "#",
      repo: "#",
    },
    {
      title: "Kawaii Hyperpop Branding",
      description: "Toxic Kawaii identity system with auto‑layout templates for social and merch.",
      tags: ["Design", "Figma", "Brand"],
      href: "#",
      repo: "#",
    },
  ];
  return (
    <Section id="work" title="Selected Work" kicker="Portfolio">
      <div className="grid grid-cols-1 gap-6 md:grid-cols-2">
        {projects.map((p) => (
          <ProjectCard key={p.title} {...p} />
        ))}
      </div>
    </Section>
  );
}

function About() {
  return (
    <Section id="about" title="About" kicker="Profile">
      <div className="grid grid-cols-1 items-start gap-8 md:grid-cols-5">
        <div className="md:col-span-3">
          <p className="text-neutral-700 dark:text-neutral-300">
            I design and build minimal, resilient frontends. I like systems that fade away and let the work speak.
            I’m currently exploring generative motion, typographic rhythm, and tactile interactions.
          </p>
          <p className="mt-4 text-neutral-700 dark:text-neutral-300">
            Tooling I enjoy: React, Tailwind, Framer Motion, Two.js, and a calm coding environment.
          </p>
        </div>
        <ul className="md:col-span-2 space-y-2 text-sm text-neutral-700 dark:text-neutral-300">
          <li><span className="font-medium">Location:</span> India (IST)</li>
          <li><span className="font-medium">Email:</span> you@example.com</li>
          <li><span className="font-medium">Status:</span> Open to opportunities</li>
        </ul>
      </div>
    </Section>
  );
}

function Contact() {
  return (
    <Section id="contact" title="Contact" kicker="Say hello">
      <form className="mx-auto max-w-xl space-y-4">
        <Input placeholder="Your name" required className="rounded-2xl" />
        <Input type="email" placeholder="Email address" required className="rounded-2xl" />
        <Textarea placeholder="Message" rows={5} required className="rounded-2xl" />
        <div className="flex items-center justify-between">
          <p className="text-xs text-neutral-500">I reply within 24–48 hours.</p>
          <Button type="submit" className="rounded-2xl">Send</Button>
        </div>
      </form>
    </Section>
  );
}

export default function Portfolio() {
  const [theme, setTheme] = useState("light");
  useEffect(() => {
    const root = document.documentElement;
    root.classList.remove(theme === "light" ? "dark" : "light");
    root.classList.add(theme);
  }, [theme]);
  const toggleTheme = () => setTheme((t) => (t === "light" ? "dark" : "light"));

  return (
    <div className={`${theme} min-h-screen bg-white text-neutral-900 transition-colors duration-300 dark:bg-neutral-950 dark:text-neutral-50`}>
      <a href="#content" className="sr-only focus:not-sr-only">Skip to content</a>
      <Nav theme={theme} toggleTheme={toggleTheme} />
      <main id="content">
        <Hero />
        <Work />
        <About />
        <Contact />
      </main>
      <footer className="border-t border-neutral-200 py-10 text-center text-sm text-neutral-500 dark:border-neutral-800">
        <div className="mx-auto max-w-6xl px-4">
          <p>© {new Date().getFullYear()} Subhajit Sarkar. Built with React · Tailwind · Two.js.</p>
        </div>
      </footer>
    </div>
  );
}

// --- Notes ---------------------------------------------------------
// • This is a single‑file React component ready to drop into a Vite/Next app.
// • Tailwind required: ensure your project is configured; classes are inline.
// • shadcn/ui + lucide-react + framer-motion + two.js should be installed.
// • Replace placeholders (email, links, résumé) to personalize.
// • Apple‑ish feel via whitespace, soft motion, and careful typography.
